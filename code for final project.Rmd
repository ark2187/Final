---
title: "Code for final project"
author: "Amanda Nagle"
date: "11/5/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Reading in a tidying the data

Reading in the border crossing data:

*   Time information was removed since all times were 12am and thus were not useful
*   All day information was removed because all were on the 1st of the month for each month
*   Years before 2000 were removed 
*   There is an Eastport (`port_name`) in Maine and Idaho. Create a port_name_state variable instead so there is no confusion 
*   Kept state variable but removed port_name-- we might want to look at state alone
*   I removed 2019 because there is only data for Jan, Feb and March
*   A lot of values were equal to 0. I removed these rows since that means there were no border crossings at that time for those measure types.

```{r clean_data}
border_crossing_df = read_csv(file = "./Border_Crossing_Entry_Data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = str_sub(date, end = -13), 
         location = str_replace(location, "POINT ", ""), 
         port_name_state = str_c(port_name, state, sep = "_")) %>% 
  separate(date, into = c("month", "day", "year"), sep = "/", convert = TRUE) %>% 
  select(-day, -port_name) %>% 
  separate(location, into = c("long", "lat"), sep = " ") %>% 
  mutate(long = str_replace(long, "\\(", ""), 
         lat = str_replace(lat, "\\)", ""), 
         long = as.numeric(long),
         lat =  as.numeric(lat)) %>% 
  filter(year >= 2000, year < 2019, value != 0)
  
```

Findings from tables below: 

*   Most border crossings in July/August. Summer vacations? 
*   Decline in border crossings since 2000. Largest drop off after 2008. Obama admin?
*   Ohio has very few border crossings and only in 2018 (Toldeo-Sandusky Port 4105). ICE issues?
*   A lot more crossings for US-Mexico border than US-Canada border

```{r summary_tables}
## Border crossings by month 
border_crossing_df %>% 
  group_by(month) %>% 
  summarize(n = sum(value))

## Border crossings by year
border_crossing_df %>% 
  group_by(year) %>% 
  summarize(n = sum(value))

## Border crossings by state
border_crossing_df %>% 
  group_by(state) %>% 
  summarize(n = sum(value))


## Border crossings by measure
border_crossing_df %>% 
  group_by(measure) %>% 
  summarize(n = sum(value))


## Border crossings by port
border_crossing_df %>% 
  group_by(port_name_state) %>% 
  summarize(n = sum(value)) %>% 
  arrange(desc(n))


## Border crossings by border 
border_crossing_df %>% 
  group_by(border) %>% 
  summarize(n = sum(value))

```

Potential Visuals: 

*    I think we can make some of these interactive in the shiny app. For example, we can set year as an input option for the drop down menu or measure type or state


```{r potential_visuals}

## Boxplot

#Just look at 2018 and personal vehicles for example here

border_crossing_df %>%
  filter(year == 2018, measure == "Personal Vehicles") %>%
  group_by(month) %>% 
  ggplot(aes(x = as.factor(month), y = value)) + 
  geom_boxplot() + 
  labs(title = "Personal Vehicle Crossings in 2018 by Month",
       x = "Month", 
       y = "Number of Crossings")


## Bar plot

border_crossing_df %>%
  group_by(month, border) %>% 
  summarize(n = sum(value)) %>% 
  ggplot(aes(x = as.factor(month), y = n, fill = border)) + 
  geom_bar(stat = "identity", position = 'dodge') + 
  labs(title = "Crossings by Month and Border",
       x = "Month", 
       y = "Number of Crossings")


## Average values over time for top 3 states in 2018
border_crossing_df %>%
  filter(state %in% c("Texas", "California", "Arizona", "New York", "Michigan"), year == 2018) %>% 
  group_by(state, month, year) %>%  
  summarize(mean_value = mean(value)) %>%
  ggplot(aes(x = month , y = mean_value, color = state)) + 
  geom_point() + 
  geom_line() + 
  theme(legend.position = "bottom") + 
  scale_x_continuous(limits = c(1,12), breaks = c(1:12)) +
  labs(title = "Average Number of Border Crossings Over Time by State",
       x = "Month", 
       y = "Number of Crossings")


## For this one, we can have a drop down option for state. will show just for New York now
border_crossing_df %>%
  filter(state == "New York") %>% 
  group_by(month, year) %>%  
  summarize(mean_value = mean(value)) %>%
  ggplot(aes(x = month , y = mean_value, color = as.factor(year))) + 
  geom_point() + 
  geom_line() + 
  theme(legend.position = "bottom") + 
  scale_x_continuous(limits = c(1,12), breaks = c(1:12)) +
  labs(title = "Average Number of Border Crossings by Year in New York",
       x = "Month", 
       y = "Number of Crossings", 
       color = "Year")


```


