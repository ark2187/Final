---
title: "Border Crossings Interactive Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(shiny)
library(plotly)
library(leaflet)
```

```{r tidied_data, message=FALSE}
border_crossing_df = read_csv(file = "./Border_Crossing_Entry_Data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(date = str_sub(date, end = -13), 
         location = str_replace(location, "POINT ", ""), 
         port_name_state = str_c(port_name, state, sep = "_")) %>% 
  separate(date, into = c("month", "day", "year"), sep = "/", convert = TRUE) %>% 
  select(-day, -port_name) %>% 
  separate(location, into = c("long", "lat"), sep = " ") %>% 
  mutate(long = str_replace(long, "\\(", ""), 
         lat = str_replace(lat, "\\)", ""), 
         long = as.numeric(long),
         lat =  as.numeric(lat)) %>% 
  filter(year >= 2000, year < 2019, value != 0)

states_func <- function(choice, states_list){
  if_else(choice %in% states_list, TRUE, FALSE)
}
```

Column {.sidebar}
-----------------------------------------------------------------------
```{r}
# Border, drop down menu
border_choices <- border_crossing_df %>%
  pull(border) %>%
  unique()

selectInput(
  inputId = "border_choice",
  label = h3("Border Choice"),
  choices = border_choices,
  selected = "US-Canada" # default
)

# Year, drop down menu
selectInput(
  inputId = "year_choice",
  label = h3("Year"),
  choices = c(2000:2018),
  selected = "2018" # default
)

# State, check multiple boxes
state_choices <- border_crossing_df %>%
  pull(state) %>%
  unique() %>%
  sort()

checkboxGroupInput( # not sure if we wanted to use this, but made it as a template
  "state_choice",
  h3("State"),
  choices = state_choices,
  selected = state_choices
)

```



Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
pal <- colorNumeric(
  palette = "viridis",
  domain = log(border_crossing_df$value))

renderLeaflet(
  border_crossing_df %>%
    mutate(state = map(state, states_func, input[["state_choice"]])) %>%
    filter(state == TRUE,
           border == input[["border_choice"]],
           year == input[["year_choice"]]) %>%
    leaflet() %>% 
    addProviderTiles(providers$CartoDB.Positron) %>%
    addCircleMarkers(~jitter(long, factor = 10), 
                     ~jitter(lat, factor = 10), radius = 5, 
                     color = ~pal(log(value)), opacity = 0.25) %>%
    addLegend("bottomright", pal = pal, values = ~log(value),
              title = "LN Number of Crossings",
              opacity = 0.25)
)

```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart B

```{r}

```

